

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Developer: Add a new SyntaxError case &mdash; Friendly tracebacks 0.0.34a documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Description of demos" href="custom.html" />
    <link rel="prev" title="Developer: Add a new Exception case" href="adding_exception.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Friendly tracebacks
          

          
          </a>

          
            
            
              <div class="version">
                0.0.34a
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="mu_thonny.html">About Mu and Thonny</a></li>
<li class="toctree-l1"><a class="reference internal" href="mu.html">Using with Mu</a></li>
<li class="toctree-l1"><a class="reference internal" href="thonny.html">Using with Thonny</a></li>
<li class="toctree-l1"><a class="reference internal" href="design.html">Some thoughts on the design of friendly-traceback</a></li>
</ul>
<p class="caption"><span class="caption-text">Known exceptions (Python 3.8)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="known.html">Known exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_en_3.8.html">Friendly tracebacks - in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_en_3.8.html">Friendly SyntaxError tracebacks - in English</a></li>
</ul>
<p class="caption"><span class="caption-text">En français</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_fr.html"> Friendly tracebacks - en Français</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_fr.html"> Friendly SyntaxError tracebacks - en Français</a></li>
</ul>
<p class="caption"><span class="caption-text">Contribute</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="suggest.html">Suggest an addition</a></li>
<li class="toctree-l1"><a class="reference internal" href="adding_exception.html">Developer: Add a new Exception case</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developer: Add a new SyntaxError case</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-test-case">Adding a test case</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#raising-an-exception">Raising an exception</a></li>
<li class="toctree-l3"><a class="reference internal" href="#catching-an-exception">Catching an exception</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#adding-generic-information">Adding generic information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-specific-information">Add specific information</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Use in your project</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="custom.html">Description of demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Public API</a></li>
<li class="toctree-l1"><a class="reference internal" href="graph.html">Project files</a></li>
<li class="toctree-l1"><a class="reference internal" href="lies.html">Intentional lies</a></li>
<li class="toctree-l1"><a class="reference internal" href="translation_notes.html">Notes on translations - using gettext</a></li>
</ul>
<p class="caption"><span class="caption-text">Other Python versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="compare.html">Comparison between Python versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_en_3.6.html">Friendly tracebacks - Python 3.6 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_en_3.6.html">SyntaxError - Python 3.6 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_en_3.7.html">Friendly tracebacks - Python 3.7 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_en_3.7.html">SyntaxError - Python 3.7 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_en_3.9.html">Friendly tracebacks - Python 3.9 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_en_3.9.html">SyntaxError - Python 3.9 in English</a></li>
</ul>
<p class="caption"><span class="caption-text">varia</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Friendly tracebacks</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Developer: Add a new SyntaxError case</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/syntax_error.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="custom.html" class="btn btn-neutral float-right" title="Description of demos" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="adding_exception.html" class="btn btn-neutral float-left" title="Developer: Add a new Exception case" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This documentation needs to, and is about to be updated significantly.</p>
</div>
<div class="section" id="developer-add-a-new-syntaxerror-case">
<h1>Developer: Add a new SyntaxError case<a class="headerlink" href="#developer-add-a-new-syntaxerror-case" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code>, and its subclasses, <code class="docutils literal notranslate"><span class="pre">IndentationError</span></code> and <code class="docutils literal notranslate"><span class="pre">TabError</span></code>,
are particular cases in that arise when a file cannot be parsed properly
by Python. Such files cannot be imported by pytest.
In order to create test cases, we need a two-step process.</p>
<p>In what follows, I assume that you are already familiar with how to
add test cases for other exceptions, and <strong>I will only focus on differences</strong>
from the other situation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Checklist</strong></p>
<p>The following are the required steps before a pull request.
Each item is explained in a different section below. If you find
the instructions unclear, please do not hesitate to reach out.</p>
<blockquote>
<div><ul>
<li><p>File an issue indicating that you are planning to work on a
given exception.</p></li>
<li><p>Add test case</p>
<blockquote>
<div><ul class="simple">
<li><p>Add /tests/syntax/raise_syntax_errorXX.py</p></li>
<li><p>Modify /tests/syntax/catch_syntax_error.py to include this new case</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Add generic information</p></li>
<li><p>Add specific information</p></li>
<li><p>Execute catch_some_exception.py and confirm visually it works as expected</p></li>
<li><p>Run pytest and confirm that your new test is included</p></li>
<li><p>Make a pull request</p></li>
</ul>
</div></blockquote>
<p>The following are additional <strong>optional</strong> steps,
dealing with the documentation
rather than the code itself.
They will need to be done at some point
but, apart for possible translations in languages other than French,
I can definitely take care of this.</p>
<blockquote>
<div><ul>
<li><p>Ensure that you have a copy of the friendly-traceceback-docs
repository; it should be located at the same directory level
as friendly-traceback on your computer.</p></li>
<li><p>Add case to tests/tb_syntax_common.py</p>
<blockquote>
<div><ul class="simple">
<li><p>Run tests/tb_english.py and ensure that
<code class="docutils literal notranslate"><span class="pre">../friendly-traceceback-docs/docs/source/tracebacks_en.rst</span></code>
shows the expected result for all Python versions.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Run make_tb.bat or do the equivalent on non Windows computer</p></li>
<li><p>Confirm that all docs/tracebacks_xx.rst include the new exception</p></li>
<li><p>Add translation</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="adding-a-test-case">
<h2>Adding a test case<a class="headerlink" href="#adding-a-test-case" title="Permalink to this headline">¶</a></h2>
<p>After you have filed an issue indicating that you wished to
adding coverage for an exception that is not previously
covered, you need to start by adding a test case.
As an example throughout, I will use the existing one for
<code class="docutils literal notranslate"><span class="pre">raise_indentation_error1.py</span></code>.</p>
<p>Note that tests for these exceptions are found in the tests/syntax/ directory.</p>
<div class="section" id="raising-an-exception">
<h3>Raising an exception<a class="headerlink" href="#raising-an-exception" title="Permalink to this headline">¶</a></h3>
<p>Your test file name should start with <code class="docutils literal notranslate"><span class="pre">raise_</span></code>,
such as <code class="docutils literal notranslate"><span class="pre">raise_indentation_error1.py</span></code>.
Here is the content of that file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;Should raise IndentationError&#39;&#39;&#39;</span>

<span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
<span class="k">pass</span>
</pre></div>
</div>
<p>As you can see, it contains invalid code.</p>
<p>For this project, pytest has been configured such that it only
includes files whose names begin with <code class="docutils literal notranslate"><span class="pre">test_</span></code> or <code class="docutils literal notranslate"><span class="pre">catch_</span></code>.
Therefore, it will ignore this file.</p>
<p>You can nonetheless test it directly, by doing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>python -m friendly_traceback tests/syntax/raise_indentation_error1.py
</pre></div>
</div>
<p>from the root directory of the repository.</p>
</div>
<div class="section" id="catching-an-exception">
<h3>Catching an exception<a class="headerlink" href="#catching-an-exception" title="Permalink to this headline">¶</a></h3>
<p>Now that we have script that can raise an exception,
we need to create a script that will catch it, and can
also be used by pytest which we use as our test runner.
Here’s only part of the content of <code class="docutils literal notranslate"><span class="pre">catch_name_error.py</span></code>,
with some numbered comments added, to which we refer below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">friendly_traceback</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="k">def</span> <span class="nf">test_indentation_error1</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">raise_indentation_error1</span>  <span class="c1"># 1 for pytest</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">raise_indentation_error1</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">friendly_traceback</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">(),</span> <span class="n">redirect</span><span class="o">=</span><span class="s2">&quot;capture&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">friendly_traceback</span><span class="o">.</span><span class="n">get_output</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s2">&quot;IndentationError: expected an indented block&quot;</span> <span class="ow">in</span> <span class="n">result</span>  <span class="c1"># 2</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">test_indentation_error1</span><span class="p">())</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Importing a test using pytest is done differently than importing it when
running this file as standalone</p></li>
<li><p>There are three possible cases of <code class="docutils literal notranslate"><span class="pre">IndentationError</span></code>. We try to be
as specific as possible in terms of which case will be indicated by Python.</p></li>
</ol>
<p>At this point, running pytest from the root directory should
work, and you should see your test case included.  You can also
run this test directly, using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">tests</span><span class="o">/</span><span class="n">syntax</span><span class="o">/</span><span class="n">catch_indentation_error</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="adding-generic-information">
<h2>Adding generic information<a class="headerlink" href="#adding-generic-information" title="Permalink to this headline">¶</a></h2>
<p>This has already been done for <code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code> and its subclasses.
Feel free to suggest improvements to the explanation given.</p>
</div>
<div class="section" id="add-specific-information">
<h2>Add specific information<a class="headerlink" href="#add-specific-information" title="Permalink to this headline">¶</a></h2>
<p>This is the tricky part.</p>
<p>The three possible causes of <code class="docutils literal notranslate"><span class="pre">IndentationError</span></code> are already covered;
this is also the case for <code class="docutils literal notranslate"><span class="pre">TabError</span></code>.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code>, we actually need to get access to the offending
code, analyze it and see if we can make an educated guess as to the
cause of the error and give proper feedback. This is done in a
separate module, <code class="docutils literal notranslate"><span class="pre">analyze_syntax.py</span></code>.
Adding support for a new case is often not straightforward.
If you wish to do so, I suggest you actually look at the code
in that module: any attempt at adding something useful in this
documentation would likely be doomed to be hopelessly out of
date and possibly misleading.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="custom.html" class="btn btn-neutral float-right" title="Description of demos" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="adding_exception.html" class="btn btn-neutral float-left" title="Developer: Add a new Exception case" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, André Roberge

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>