

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Developer: Add a new Exception case &mdash; Friendly tracebacks 0.1.1a documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Developer: Add a new SyntaxError case" href="syntax_error.html" />
    <link rel="prev" title="Suggest an addition" href="suggest.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Friendly tracebacks
          

          
          </a>

          
            
            
              <div class="version">
                0.1.1a
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">For beginners and teachers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="thonny.html">Using with Thonny</a></li>
<li class="toctree-l1"><a class="reference internal" href="mu.html">Using with Mu</a></li>
</ul>
<p class="caption"><span class="caption-text">Thoughts on design</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="design.html">Some thoughts on the design of friendly-traceback</a></li>
<li class="toctree-l1"><a class="reference internal" href="verbosity.html">Verbosity: how much information do we want?</a></li>
</ul>
<p class="caption"><span class="caption-text">More advanced users</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="usage_adv.html">Advanced Usage</a></li>
</ul>
<p class="caption"><span class="caption-text">Use in your project</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="lies.html">Intentional lies</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Public API</a></li>
<li class="toctree-l1"><a class="reference internal" href="graph.html">Project files</a></li>
</ul>
<p class="caption"><span class="caption-text">Contribute</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="suggest.html">Suggest an addition</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developer: Add a new Exception case</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-test-case">Adding a test case</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-with-pytest">Running with pytest</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-generic-information">Adding generic information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-specific-information">Add specific information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-another-assertion">Add another assertion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-your-work">Test your work</a></li>
<li class="toctree-l2"><a class="reference internal" href="#make-a-pull-request">Make a pull request</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="syntax_error.html">Developer: Add a new SyntaxError case</a></li>
<li class="toctree-l1"><a class="reference internal" href="translation_notes.html">Notes on translations - using gettext</a></li>
</ul>
<p class="caption"><span class="caption-text">All the tracebacks!</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="known.html">Known exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_en_3.6.html">Friendly tracebacks - Python 3.6 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_en_3.6.html">SyntaxError - Python 3.6 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_en_3.7.html">Friendly tracebacks - Python 3.7 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_en_3.7.html">SyntaxError - Python 3.7 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_en_3.8.html">Friendly tracebacks - Python 3.8 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_en_3.8.html">SyntaxError - Python 3.8 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_en_3.9.html">Friendly tracebacks - Python 3.9 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_en_3.9.html">SyntaxError - Python 3.9 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_en_3.10.html">Friendly tracebacks - Python 3.10 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_en_3.10.html">SyntaxError - Python 3.10 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="compare_exceptions.html">Comparing Exception messages between Python versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="compare.html">Comparison between Python versions: SyntaxErrors</a></li>
</ul>
<p class="caption"><span class="caption-text">Markdown examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_markdown.html">Friendly tracebacks - markdown_docs format</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_syntax_markdown.html">Syntax errors - markdown_docs format</a></li>
</ul>
<p class="caption"><span class="caption-text">En français</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_fr.html"> Friendly tracebacks - en Français</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_fr.html"> Friendly SyntaxError tracebacks - en Français</a></li>
</ul>
<p class="caption"><span class="caption-text">varia</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Friendly tracebacks</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Developer: Add a new Exception case</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/adding_exception.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="syntax_error.html" class="btn btn-neutral float-right" title="Developer: Add a new SyntaxError case" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="suggest.html" class="btn btn-neutral float-left" title="Suggest an addition" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is alpha software, currently in development.
The API is subject to change without notice;
many such changes are not yet included in this documentation.
The aim is to have (almost) all the text updated and corrected
by the time version 0.1 is released, at which time this warning
will change.</p>
<p>Note that most screenshots have been taken with an obsolete version.
We aim to replace those when work for version 0.2 has been completed.</p>
</div>
<div class="section" id="developer-add-a-new-exception-case">
<span id="adding-exception"></span><h1>Developer: Add a new Exception case<a class="headerlink" href="#developer-add-a-new-exception-case" title="Permalink to this headline">¶</a></h1>
<p>This primarily describes the situation where you wish to add friendly
tracebacks for an Exception that is not already included.
<strong>It does not apply to</strong> <code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code> <strong>and its subclasses,</strong>
<code class="docutils literal notranslate"><span class="pre">IndentationError</span></code> and <code class="docutils literal notranslate"><span class="pre">TabError</span></code>, <strong>which need to be dealt separately.</strong></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Any contribution, <strong>no matter how small</strong>, is welcome.
The following checklist
is provided for those that are ambitious and want to do all the required
steps by themselves to include a new case.
You definitely do not have to do all of this.</p>
<p><strong>Checklist</strong></p>
<p>The following are the include all the steps that have to be done
to consider that a new case has been completely covered.
Most individual steps are explained in a different section below.
If you find the instructions unclear, please do not hesitate to reach out.</p>
<blockquote>
<div><ul class="simple">
<li><p>File an issue indicating that you are planning to work on a
given exception. This should be done if you are planning to
submit something within a week or so.</p></li>
<li><p>Add /tests/except/test_new_error.py</p></li>
<li><p>Run pytest with one of Python’s supported versions (3.6 to 3.9)
and confirm that your new test is included</p></li>
<li><p>Add generic information about this Exception</p></li>
<li><p>Add specific information about this Exception</p></li>
<li><p>Add another assertion in test case, to be run if the language
is English, that confirms that (part of) the specific information
is included in the traceback</p></li>
<li><p>Execute test_new_error.py and confirm visually it works as expected</p></li>
<li><p>Run pytest and confirm that your new test is included</p></li>
<li><p>For completeness, you could check to see that all this works
properly with all supported Python versions: sometimes the text
of the message changes from one Python version to another.</p></li>
</ul>
</div></blockquote>
<p>After completing any of the steps above (other than the first one),
feel free to make a pull request so that your code can be included.
If you want to contribute and do not know how to do a pull request,
or find it too complicated, please contact me: we’ll find a way to help you
contribute.</p>
<p>The following are additional steps, dealing with the documentation
rather than the code itself.
They will need to be done at some point
but, apart for possible translations in languages other than French,
it is usually something that I do myself. As I do not expect
contributions for this, I did not include detailed explanations of
each steps. Let me know if you’d like to work on this and need
more details.</p>
<blockquote>
<div><ul>
<li><p>Ensure that you have a copy of the friendly-traceceback-docs
repository; it should be located at the same directory level
as friendly-traceback on your computer.</p></li>
<li><p>Add case to tests/tb_common.py</p>
<blockquote>
<div><ul class="simple">
<li><p>Run tests/tb_english.py and ensure that
<code class="docutils literal notranslate"><span class="pre">../friendly-traceceback-docs/docs/source/tracebacks_en.rst</span></code>
shows the expected result for all Python versions.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Run make_tb.bat or do the equivalent on non Windows computer</p></li>
<li><p>Confirm that all docs/tracebacks_xx.rst include the new exception</p></li>
<li><p>Add translation; currenly only French is supported.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="adding-a-test-case">
<h2>Adding a test case<a class="headerlink" href="#adding-a-test-case" title="Permalink to this headline">¶</a></h2>
<p>After you have filed an issue indicating that you wished to
adding coverage for an exception that is not previously
covered, you need to start by adding a test case.
As an example throughout, I will use the existing one for
<code class="docutils literal notranslate"><span class="pre">UnboundLocalError</span></code>. I am documenting the process as I go through.</p>
<p>In this project, we use <a class="reference external" href="https://docs.pytest.org/en/latest/">pytest</a> and
simple assertion-based tests.</p>
<p>For named exceptions, test files are located in the <code class="docutils literal notranslate"><span class="pre">tests/except</span></code> directory.
Your test file name should start with <code class="docutils literal notranslate"><span class="pre">test_</span></code>,
such as <code class="docutils literal notranslate"><span class="pre">test_unbound_local_error.py</span></code>.
Here is what was the <strong>initial</strong> content of that file,
with some numbered comments added:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">friendly_traceback</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="k">def</span> <span class="nf">test_unbound_local_error</span><span class="p">():</span>    <span class="c1"># 1</span>
    <span class="sd">&quot;&quot;&quot;Should raise UnboundLocalError&quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
        <span class="n">a</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">inner</span><span class="p">()</span>   <span class="c1"># 2</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">friendly_traceback</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">(),</span> <span class="n">redirect</span><span class="o">=</span><span class="s2">&quot;capture&quot;</span><span class="p">)</span>  <span class="c1"># 3</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">friendly_traceback</span><span class="o">.</span><span class="n">get_output</span><span class="p">()</span>  <span class="c1"># 4</span>
    <span class="k">assert</span> <span class="s2">&quot;UnboundLocalError&quot;</span> <span class="ow">in</span> <span class="n">result</span>  <span class="c1"># 5</span>
    <span class="k">return</span> <span class="n">result</span>  <span class="c1"># 6</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">test_unbound_local_error</span><span class="p">())</span>  <span class="c1"># 7</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Test functions should start with <cite>test_</cite>, so as to be recognized by pytest.
I like to use a name written that reflects the name of the exception,
replacing any uppercase letter in the exception name by an underscore
followed by a lowercase version of the letter.</p></li>
<li><p>The code raising an error is inserted in a try/except clause.
Friendly-traceback can be installed globally as an exception hook but
this would not work when using pytest. <strong>Important:</strong> unless there is no
other way, you should not trigger an exception by an explicit call
using the <code class="docutils literal notranslate"><span class="pre">raise</span></code> keyword, so that the message included is produce
by Python and not artificially written. Whenever possible, friendly-traceback
provides some specific information about an exception based on the content
of the message included by Python.</p></li>
<li><p>By default, friendly_traceback outputs its result to sys.stderr.
However, this can be redirected to any other user provided
function. In addition, there is a “capture” mode, as indicated,
which simply stores the result.</p></li>
<li><p>To retrieve the previously stored result, we use the
<code class="docutils literal notranslate"><span class="pre">get_output()</span></code> method. By default, this method also empties
the cache used to capture the output. There is an optional
argument to change this behaviour but it would be counter
productive in this situation as we wish our tests to be done
independently.</p></li>
<li><p>Pytest checks for assertion errors. So, we include parts of
what we expect to see in the output. This is usually the
beginning of the line just below <code class="docutils literal notranslate"><span class="pre">Python</span> <span class="pre">exception:</span></code> that
was shown when running something like <code class="docutils literal notranslate"><span class="pre">raise_myexception.py</span></code>
previously. For reliability, we should include more than
just the name of the Exception. Just leave any information
about the line and file number out, to avoid making the tests
brittle if we were to change either.</p></li>
<li><p>We must return the previously captured result for independent
testing.</p></li>
<li><p>This enables us to run this test by itself, without Pytest.</p></li>
</ol>
<p>So, let’s see what happens if we do run this test by itself.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python tests/except/test_unbound_local_error.py

    Python exception:
       UnboundLocalError: local variable &#39;a&#39; referenced before assignment

    No information is known about this exception.


    Execution stopped on line 15 of file &#39;test_unbound_local_error.py&#39;.

       13:
       14:     try:
    --&gt;15:         inner()
       16:     except Exception:


    Exception raised on line 12 of file &#39;test_unbound_local_error.py&#39;.

       10:
       11:     def inner():
    --&gt;12:         a += 1
       13:
</pre></div>
</div>
<p>Note the line:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>No information is known about this exception.
</pre></div>
</div>
<p>We will soon want to correct this. However, before we do so,
in order to make our test more accurate, we replace the line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="s2">&quot;UnboundLocalError&quot;</span> <span class="ow">in</span> <span class="n">result</span>
</pre></div>
</div>
<p>by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="s2">&quot;UnboundLocalError: local variable &#39;a&#39; referenced before assignment&quot;</span> <span class="ow">in</span> <span class="n">result</span>
</pre></div>
</div>
</div>
<div class="section" id="running-with-pytest">
<h2>Running with pytest<a class="headerlink" href="#running-with-pytest" title="Permalink to this headline">¶</a></h2>
<p>This assumes that pytest is installed on your computer.
From Friendly-traceback’s root directory, simply run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pytest</span>
</pre></div>
</div>
<p>You should see your test file listed, and no test failures reported by pytest.</p>
</div>
<div class="section" id="adding-generic-information">
<h2>Adding generic information<a class="headerlink" href="#adding-generic-information" title="Permalink to this headline">¶</a></h2>
<p>The main goal of friendly_tracebacks is to help beginners and/or
programmers whose knowledge of English is limited,
to understand what a given exception means.
So, your first goal is to imagine that you are helping a beginner
understand what <code class="docutils literal notranslate"><span class="pre">SomeException</span></code> means, writing in English with
as little Python-specific jargon as possible.  Try to do
so in a short paragraph. Do not strive for perfection.
It is expected that we will hear from actual users
(teachers and students) using friendly_tracebacks and that we
will be able to improve the descriptions based on their feedback,
and not based on our own pre-conceptions.</p>
<p>Generic information about given exceptions is found in file
<code class="docutils literal notranslate"><span class="pre">friendly_traceback/info_generic.py</span></code>.
Here are the relevant parts of that file for the UnboundLocalError
exception, followed by some explications:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@register</span><span class="p">(</span><span class="s2">&quot;UnboundLocalError&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unbound_local_error</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">current_lang</span><span class="o">.</span><span class="n">lang</span>
    <span class="k">return</span> <span class="n">_</span><span class="p">(</span>
        <span class="s2">&quot;In Python, variables that are used inside a function are known as </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;local variables. Before they are used, they must be assigned a value.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;A variable that is used before it is assigned a value is assumed to</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;be defined outside that function; it is known as a &#39;global&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;(or sometimes &#39;nonlocal&#39;) variable. You cannot assign a value to such</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;a global variable inside a function without first indicating to</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Python that this is a global variable, otherwise you will see</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;an UnboundLocalError.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>This generic explanation is rather long.
As mentioned before, if possible, you should make it
as short as possible while giving enough information so that a beginner
would understand what such an exception means.</p>
<p>We use gettext for providing translations. You do not need to be
familiar with gettext for this doing this work.
For those that are familiar with gettext, the most common way
to use it is to <strong>install</strong> it globally, so that the function <code class="docutils literal notranslate"><span class="pre">_</span></code>
is added to Python’s builtins and can be used everywhere.
However, this conflicts with using <code class="docutils literal notranslate"><span class="pre">_</span></code> in the console (REPL) as
the value of the last command; for this reason, we use <code class="docutils literal notranslate"><span class="pre">_</span></code>
as a local variable inside any function which contains some strings
to be translated.</p>
<p>We first define a function whose name reflects the exception
we wish to explain.
This is not strictly required but it makes it easier to find the
information when looking at the code. Thus, for <code class="docutils literal notranslate"><span class="pre">UnboundLocalError</span></code>,
we defined <code class="docutils literal notranslate"><span class="pre">unbound_local_error()</span></code>.
We use <code class="docutils literal notranslate"><span class="pre">register</span></code> as a decorator to add it to the known
cases automatically.
This function will receive some positional arguments that
may be useful for some exceptions.  For the first run through, you can
assume that you can ignore these arguments.</p>
<p>Ideally, this function should be inserted sorted alphabetically
in the file.</p>
<p>The first line of the function is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">current_lang</span><span class="o">.</span><span class="n">lang</span>
</pre></div>
</div>
<p>This ensures that translations done by gettext are handled correctly.</p>
<p>Next, we return a string enclosed by <code class="docutils literal notranslate"><span class="pre">_(</span> <span class="pre">)</span></code>; this is a call to
gettext to retrieve the correct translation.</p>
<p>For clarity, instead of using triple-quoted strings, we use Python’s
automatic concatenation of adjacent strings to format the text.
Experience has shown us that this makes it much easier to
write the corresponding translations using Poedit, as described elsewhere.
Each string should represent a single line of text, and end with
a single <code class="docutils literal notranslate"><span class="pre">\n</span></code>.</p>
</div>
<div class="section" id="add-specific-information">
<h2>Add specific information<a class="headerlink" href="#add-specific-information" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In some cases, it could happen that no specific information, as
described below, is needed. In this case, you should still define
a function for the specific information, so that we know it has
not been overlooked, but have that function simply return <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</div>
<p>Let’s look again at the output for UnboundLocalError.
At the top of the feedback given by friendly_traceback, we
see the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Python exception:
    UnboundLocalError: local variable &#39;a&#39; referenced before assignment
</pre></div>
</div>
<p>The second line is the information given by Python.
Your goal should be to rephrase this information in a way that
is possibly easier to understand by beginners <strong>and</strong> which can
be translated into languages other than English.
It should also follow naturally from your generic information.</p>
<p>In some cases, such as <code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code>, we might need the actual
source code in order to provide some very specific information.
For now, we assume here that this is not the case.</p>
<p>Examining the line <code class="docutils literal notranslate"><span class="pre">UnboundLocalError:</span> <span class="pre">local</span> <span class="pre">variable</span> <span class="pre">'a'</span> <span class="pre">referenced</span> <span class="pre">before</span> <span class="pre">assignment</span></code>, we
see that it refers to a variable name, <code class="docutils literal notranslate"><span class="pre">a</span></code>, which will almost
certainly be different when another user encounters a similar error.
Thus, our specific information should probably include this as a variable.</p>
<p>Specific information about given exceptions is found in file
<code class="docutils literal notranslate"><span class="pre">friendly_traceback/info_specific.py</span></code>.
Here are the relevant parts of that file for the UnboundLocalError
exception:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@register</span><span class="p">(</span><span class="s2">&quot;UnboundLocalError&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unbound_local_error</span><span class="p">(</span><span class="n">etype</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">current_lang</span><span class="o">.</span><span class="n">lang</span>
    <span class="c1"># value is expected to be something like</span>
    <span class="c1">#</span>
    <span class="c1"># UnboundLocalError: local variable &#39;a&#39; referenced before assignment</span>
    <span class="c1">#</span>
    <span class="c1"># By splitting value using &#39;, we can extract the variable name.</span>
    <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;The variable that appears to cause the problem is &#39;</span><span class="si">{var_name}</span><span class="s2">&#39;.</span><span class="se">\n</span><span class="s2">&quot;</span>
             <span class="s2">&quot;Try inserting the statement</span><span class="se">\n</span><span class="s2">&quot;</span>
             <span class="s2">&quot;    global </span><span class="si">{var_name}</span><span class="se">\n</span><span class="s2">&quot;</span>
             <span class="s2">&quot;as the first line inside your function.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">var_name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>I assume that this is similar enough to the situation for the
generic information case that it does not warrant additional
explanation.</p>
<p>If you find that some additional explanation is needed,
please contact me or file an issue.</p>
</div>
<div class="section" id="add-another-assertion">
<h2>Add another assertion<a class="headerlink" href="#add-another-assertion" title="Permalink to this headline">¶</a></h2>
<p>To ensure that Friendly-traceback does not misidentify a given case,
include another assertion in the test,
this one based on the specific information given in your test case.
This test should not pass simply based on the
information given by Python: it should rely on the specificity of the
explanation you provide.  In the example I give above, the additional
assertion is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="s2">&quot;The variable that appears to cause the problem is &#39;a&#39;.&quot;</span> <span class="ow">in</span> <span class="n">result</span>
</pre></div>
</div>
<p>To ensure that this will not cause problems when creating sample tracebacks
for languages other than English, we make sure to check this assertion
only if the language set is English.</p>
<p>And here, after quite a few revisions,
is the <strong>final</strong> content of that file, where the initial
single very basic assertion has been replaced by two longer ones.
While this was not necessary, I also moved the offending Python code out
of the test function, and made is slightly more complicated as it
gave a more interesting traceback, showing the values of
local and global variables, which was not something
that could be done when I first created this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># More complex example than needed - used for documentation</span>
<span class="kn">import</span> <span class="nn">friendly_traceback</span>

<span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">outer</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span>
    <span class="n">inner</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">test_unbound_local_error</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Should raise UnboundLocalError&quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">outer</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">friendly_traceback</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">redirect</span><span class="o">=</span><span class="s2">&quot;capture&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">friendly_traceback</span><span class="o">.</span><span class="n">get_output</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s2">&quot;UnboundLocalError: local variable &#39;a&#39; referenced&quot;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="k">if</span> <span class="n">friendly_traceback</span><span class="o">.</span><span class="n">get_lang</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;en&#39;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="s2">&quot;The variable that appears to cause the problem is &#39;a&#39;.&quot;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">test_unbound_local_error</span><span class="p">())</span>
</pre></div>
</div>
<p>The following is the output for this revised example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Python</span> <span class="n">exception</span><span class="p">:</span>
    <span class="ne">UnboundLocalError</span><span class="p">:</span> <span class="n">local</span> <span class="n">variable</span> <span class="s1">&#39;a&#39;</span> <span class="n">referenced</span> <span class="n">before</span> <span class="n">assignment</span>

<span class="n">In</span> <span class="n">Python</span><span class="p">,</span> <span class="n">variables</span> <span class="n">that</span> <span class="n">are</span> <span class="n">used</span> <span class="n">inside</span> <span class="n">a</span> <span class="n">function</span> <span class="n">are</span> <span class="n">known</span> <span class="k">as</span>
<span class="n">local</span> <span class="n">variables</span><span class="o">.</span> <span class="n">Before</span> <span class="n">they</span> <span class="n">are</span> <span class="n">used</span><span class="p">,</span> <span class="n">they</span> <span class="n">must</span> <span class="n">be</span> <span class="n">assigned</span> <span class="n">a</span> <span class="n">value</span><span class="o">.</span>
<span class="n">A</span> <span class="n">variable</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">before</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">assigned</span> <span class="n">a</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">assumed</span> <span class="n">to</span>
<span class="n">be</span> <span class="n">defined</span> <span class="n">outside</span> <span class="n">that</span> <span class="n">function</span><span class="p">;</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">known</span> <span class="k">as</span> <span class="n">a</span> <span class="s1">&#39;global&#39;</span>
<span class="p">(</span><span class="ow">or</span> <span class="n">sometimes</span> <span class="s1">&#39;nonlocal&#39;</span><span class="p">)</span> <span class="n">variable</span><span class="o">.</span> <span class="n">You</span> <span class="n">cannot</span> <span class="n">assign</span> <span class="n">a</span> <span class="n">value</span> <span class="n">to</span> <span class="n">such</span>
<span class="n">a</span> <span class="k">global</span> <span class="n">variable</span> <span class="n">inside</span> <span class="n">a</span> <span class="n">function</span> <span class="n">without</span> <span class="n">first</span> <span class="n">indicating</span> <span class="n">to</span>
<span class="n">Python</span> <span class="n">that</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">a</span> <span class="k">global</span> <span class="n">variable</span><span class="p">,</span> <span class="n">otherwise</span> <span class="n">you</span> <span class="n">will</span> <span class="n">see</span>
<span class="n">an</span> <span class="ne">UnboundLocalError</span><span class="o">.</span>

<span class="n">Likely</span> <span class="n">cause</span> <span class="n">based</span> <span class="n">on</span> <span class="n">the</span> <span class="n">information</span> <span class="n">given</span> <span class="n">by</span> <span class="n">Python</span><span class="p">:</span>
    <span class="n">The</span> <span class="n">variable</span> <span class="n">that</span> <span class="n">appears</span> <span class="n">to</span> <span class="n">cause</span> <span class="n">the</span> <span class="n">problem</span> <span class="ow">is</span> <span class="s1">&#39;a&#39;</span><span class="o">.</span>
    <span class="n">Perhaps</span> <span class="n">the</span> <span class="n">statement</span>
        <span class="k">global</span> <span class="n">a</span>
    <span class="n">should</span> <span class="n">have</span> <span class="n">been</span> <span class="n">included</span> <span class="k">as</span> <span class="n">the</span> <span class="n">first</span> <span class="n">line</span> <span class="n">inside</span> <span class="n">your</span> <span class="n">function</span><span class="o">.</span>

<span class="n">Execution</span> <span class="n">stopped</span> <span class="n">on</span> <span class="n">line</span> <span class="mi">20</span> <span class="n">of</span> <span class="n">file</span> <span class="s1">&#39;tests\except</span><span class="se">\t</span><span class="s1">est_unbound_local_error.py&#39;</span><span class="o">.</span>

   <span class="mi">18</span><span class="p">:</span>
   <span class="mi">19</span><span class="p">:</span>     <span class="k">try</span><span class="p">:</span>
<span class="o">--&gt;</span><span class="mi">20</span><span class="p">:</span>         <span class="n">outer</span><span class="p">()</span>
   <span class="mi">21</span><span class="p">:</span>     <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>

<span class="k">global</span> <span class="n">outer</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">outer</span><span class="o">&gt;</span>

<span class="ne">Exception</span> <span class="n">raised</span> <span class="n">on</span> <span class="n">line</span> <span class="mi">12</span> <span class="n">of</span> <span class="n">file</span> <span class="s1">&#39;tests\except</span><span class="se">\t</span><span class="s1">est_unbound_local_error.py&#39;</span><span class="o">.</span>

   <span class="mi">10</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
   <span class="mi">11</span><span class="p">:</span>         <span class="n">c</span> <span class="o">=</span> <span class="mi">3</span>
<span class="o">--&gt;</span><span class="mi">12</span><span class="p">:</span>         <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span>
   <span class="mi">13</span><span class="p">:</span>     <span class="n">inner</span><span class="p">()</span>

<span class="k">global</span> <span class="n">b</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">c</span><span class="p">:</span> <span class="mi">3</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Each test case should contain at least two distinct assertions:</p>
<ol class="arabic simple">
<li><p>One based on the information given by Python about the exception.</p></li>
<li><p>One or more based on the specific information information provided by
Friendly-traceback. These should be only checked if the language
is set to English (<code class="docutils literal notranslate"><span class="pre">'en'</span></code>)</p></li>
</ol>
</div>
</div>
<div class="section" id="test-your-work">
<h2>Test your work<a class="headerlink" href="#test-your-work" title="Permalink to this headline">¶</a></h2>
<p>Now that you have added the generic and specific information,
you might want to test again by running something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">tests</span><span class="o">/</span><span class="k">except</span><span class="o">/</span><span class="n">test_my_exception</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>and confirm that the result is acceptable.</p>
<p>Once this is done, run pytest once again from the root directory to make
sure that your new case is included correctly in the test suite.</p>
</div>
<div class="section" id="make-a-pull-request">
<h2>Make a pull request<a class="headerlink" href="#make-a-pull-request" title="Permalink to this headline">¶</a></h2>
<p>Before submitting your code, with the possible exception of test cases,
you should make sure that your code
is formatted correctly according to <a class="reference external" href="https://github.com/ambv/black">black</a></p>
<p>However, we ask that you ensures that your added text
uses the one-line-per-string format described above.
If black reformats your code such that this is not the case, you
can temporarily turn it off and back on around the relevant
code.  Here’s an example that we currently have in our code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># fmt: off</span>
<span class="k">return</span> <span class="n">_</span><span class="p">(</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;Python exception: </span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;    </span><span class="si">{name}</span><span class="s2">: </span><span class="si">{value}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;</span><span class="si">{explanation}</span><span class="s2">&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">explanation</span><span class="o">=</span><span class="n">explanation</span><span class="p">)</span>
<span class="c1"># fmt: on</span>
</pre></div>
</div>
<p>Next, you should make sure that your local repository is up to date
and fix any conflict that might be arising.</p>
<p>Finally, you can proceed with a <a class="reference external" href="https://help.github.com/en/articles/creating-a-pull-request">pull request</a>.
If the information provided in that link is not clear, please do
not hesitate to ask for clarification.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="syntax_error.html" class="btn btn-neutral float-right" title="Developer: Add a new SyntaxError case" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="suggest.html" class="btn btn-neutral float-left" title="Suggest an addition" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, André Roberge

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>